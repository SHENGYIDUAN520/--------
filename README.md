# 智能陪护监控平台

## 项目概述

智能陪护监控平台是一套基于深度学习和计算机视觉技术的养老监护系统，通过摄像头实时分析老人的行为和状态，自动检测异常情况并发出警报。系统包括前端监控界面、后端服务器和数据分析模块，为养老机构提供全面的智能监控解决方案。

## 硬件配置

- **开发板**：立创·庐山派-K230-CanMV开发板
  - 处理器：嘉楠K230 AI芯片
  - 内存：512MB
  - 接口：40针树莓派兼容GPIO接口，支持I2C、SPI、UART等标准协议
  - AI能力：支持多种AI模型，如人脸检测、姿态识别、跌倒检测等
  - ADC接口：提供4路ADC输入（最高支持1.8V输入电压）
  - CSI接口：支持多达3路摄像头输入
- **摄像头**：立创·GC2093-200W摄像头-小镜头版-定焦70cm
  - 感光元件：GC2093
  - 最大分辨率：1920x1080
  - 最大帧率：60fps
  - 焦距：4.3MM
  - 视场角：D73°/H65°/V40°
  - 接口：22P 0.5mm间距CSI2接口
- **存储**：8G TF卡（Class10及以上，MK品牌推荐）
- **服务器**：阿里云ECS（4核8G内存）
公网ip   47.97.160.91

## 技术栈

- 前端：HTML5, CSS3, JavaScript, ECharts
- 后端：Python, Flask
- 数据库：MySQL
- 图像处理：OpenCV, Paddle
- 部署：Alibaba Cloud ECS (47.97.160.91)

## 开发环境

### 本地开发环境

- **操作系统**: Windows 10/11
- **数据库**: MySQL 8.0 (本地实例)
- **前端服务**: 直接通过浏览器加载HTML文件
- **后端服务**: Python Flask (开发模式)
- **集成开发环境**: Visual Studio Code
- **K230开发环境**: CanMV IDE K230 (最新版本4.0.7+)

### 生产环境

- **服务器**: 阿里云ECS Ubuntu 20.04 LTS
- **Web服务器**: Nginx 1.18+ (作为反向代理)
- **应用服务器**: Gunicorn + Flask
- **数据库**: MySQL 8.0
- **监控**: 阿里云监控服务

## 开发进度记录

### 2024-06-01 页面功能优化与交互改进

- 修复紧急联系人面板无法滚动的问题，添加滚动功能使所有联系人可见
- 优化联系人面板样式，改进UI显示效果，包括联系人卡片布局和间距
- 美化滚动条样式，提升用户体验
- 确保"刘叔叔"作为邻居联系人也被包含在默认数据中
- 统一联系人卡片样式，优化电话按钮显示

### 2024-05-31 UI优化与系统调整

- 彻底移除状态检测面板中的心率、活动和体温指示器部分，保持界面简洁
- 修改静坐时间管控图表颜色，将活动颜色改为绿色(#4CAF50)，保持静坐为红色(#FF6B6B)
- 在紧急联系人默认数据中增加"邻居"联系人，提升数据完整性
- 统一UI颜色方案，确保视觉呈现一致性
- 优化页面布局结构，移除不需要的UI元素

### 2024-05-30 界面UI优化与功能调整

- 移除状态检测面板中的心率、活动和体温指示器，仅保留图表显示
- 修改静坐时间管控图表颜色，使其与设计UI匹配（活动：绿色，静坐：红色）
- 在紧急联系人中增加"邻居"作为默认数据，增强数据完整性
- 优化数据为空时的默认数据处理，提高用户体验
- 调整各图表的颜色方案，使整体视觉效果更协调
- 统一错误处理逻辑，确保在API访问失败时能显示合理的默认数据

### 2024-05-29 前端数据加载优化

- 优化main.js文件中的数据加载逻辑，改进API请求错误处理
- 增强getRequest函数调用，确保正确处理加载指示器
- 实现数据加载失败时使用默认数据，提高用户体验
- 完善各面板更新函数中的错误处理，增加try-catch机制
- 优化面板更新逻辑，支持部分数据更新且保留默认值
- 为所有API调用添加console日志，便于调试
- 修改联系人UI更新逻辑，保留加载指示器元素

### 2024-05-27 系统设置功能优化与数据库对接

- 完善系统设置模块中的账户设置功能，实现与API的对接
- 优化老人管理功能，实现老人信息的添加、编辑和删除
- 完善紧急联系人管理系统，实现与老人信息的关联
- 修改模态窗口表单内容，确保与后端API数据结构匹配
- 优化页面数据加载和表单提交流程
- 实现实时数据验证和用户友好的错误提示

### 2024-05-25 前后端集成与数据流优化

- 完成数据库API与前端页面的深度集成
- 优化视频流处理模块，实现实时视频传输和存储
- 改进前端用户认证流程，增强安全性
- 老人信息管理系统功能完善，支持批量导入与导出
- 统一数据获取接口，采用RESTful API标准
- 解决跨域问题，确保开发环境和生产环境一致性
- 规划K230开发板与服务器间的通信协议升级

### 2024-05-23 用户管理功能增强

- 实现用户注册功能，添加前端注册页面(register.html)和相关业务逻辑
- 完善用户信息验证机制，包括密码强度检查、邮箱格式验证等
- 优化登录/注册页面UI，添加表单验证和用户友好提示
- 增强前后端用户系统对接，改善用户体验

### 2024-05-15 数据库与API对接

- 创建并成功初始化MySQL数据库，建立基本表结构
- 移除Redis相关代码，统一使用MySQL作为唯一数据存储
- 实现数据库API模块(database/api.py)，提供各类数据操作接口
- 创建Flask应用程序(app.py)，实现RESTful API接口
- 前端页面重构，移除本地静态数据，改为动态加载结构
- 实现用户认证、会话管理等基础功能

### 2024-05-10 前端页面基础开发

- 开发首页仪表盘界面，包含多个数据展示面板
- 实现老人详情页面，用于展示老人基本信息和活动数据
- 开发视频监控页面，支持实时视频流显示和录制功能
- 实现系统设置页面，包含用户管理、设备配置等功能
- 添加页面导航和基础样式

### 2024-05-05 数据库设计与配置

- 设计数据库表结构，包括用户、老人信息、设备、报警事件等
- 配置MySQL数据库连接
- 初步规划Redis缓存(后决定不使用)
- 编写数据库初始化脚本

### 2024-04-30 项目初始化

- 确定项目架构和技术栈
- 设置开发环境
- 创建项目基础目录结构
- 编写项目需求文档

## 项目结构

```
智能陪护监控平台/
│
├── database/               # 数据库相关模块
│   ├── __init__.py         # 数据库模块入口
│   ├── mysql_db.py         # MySQL连接和操作
│   ├── api.py              # 数据库API接口
│   ├── config.py           # 数据库配置
│   └── init_db.py          # 数据库初始化脚本
│
├── static/                 # 前端静态资源
│   ├── css/                # 样式文件
│   ├── js/                 # JavaScript文件
│   │   ├── common.js       # 通用JavaScript函数
│   │   ├── main.js         # 主页面脚本
│   │   ├── login.js        # 登录页面脚本
│   │   └── register.js     # 注册页面脚本
│   ├── img/                # 图片资源
│   ├── index.html          # 首页
│   ├── detail.html         # 老人详情页
│   ├── video.html          # 视频监控页
│   ├── settings.html       # 系统设置页
│   ├── login.html          # 登录页面
│   └── register.html       # 注册页面
│
├── app.py                  # Flask应用程序入口
├── requirements.txt        # 项目依赖
└── README.md               # 项目说明文档
```

## 核心功能

- 实时视频监控：支持多路摄像头，提供流畅的视频流显示
- 跌倒检测与报警：利用YOLOv5n-falldown模型实时检测老人跌倒情况
- 人脸识别与老人识别：使用K230内置的人脸识别功能识别老人身份
- 姿态异常检测：基于YOLOv8n-pose模型分析老人姿态是否异常
- 历史录像存储与回放：支持录像的存储、检索和回放
- 设备管理：支持摄像头的添加、配置和状态监控
- 用户权限管理：分级权限控制，支持管理员、工作人员和家属角色
- 报警事件管理与处理：报警事件的记录、通知和处理流程

## 系统架构

1. **前端部分**
   - 用户管理界面：管理系统用户，分配权限
   - 视频监控界面：实时展示多路摄像头画面，显示警报信息
   - 老人详情界面：展示老人基本信息和历史记录
   - 历史记录查询界面：检索和播放历史视频记录
   - 报警通知与处理界面：显示报警事件，提供处理操作
   - 设置界面：系统参数配置，设备管理

2. **后端部分**
   - Flask Web服务器：提供API接口，处理前端请求
   - 视频流处理模块：接收并处理K230发送的视频流
   - 数据库存储与查询模块：管理MySQL数据操作
   - 用户认证与权限控制模块：JWT认证和权限验证
   - 报警事件处理模块：处理异常事件，发送通知
   - WebSocket实时通信：实现报警的实时推送

3. **数据库设计**
   - 用户管理表：存储用户信息和权限
   - 老人信息表：记录老人基本信息
   - 摄像头设备表：管理摄像头配置和状态
   - 视频记录表：存储录像文件信息
   - 报警事件表：记录异常事件详情和处理状态
   - 设备状态表：记录设备的在线状态和最后活动时间
   - 临时会话表：存储用户会话和临时数据

4. **边缘计算部分**
   - 庐山派K230开发板：搭载嘉楠K230 AI芯片
   - 摄像头视频采集：支持多路摄像头输入
   - 本地AI推理：在边缘设备上进行AI模型推理
     - 跌倒检测：使用YOLOv5n-falldown模型
     - 姿态识别：使用YOLOv8n-pose模型
     - 人脸识别：使用K230内置模型
   - 报警事件上传：通过HTTP接口上传异常事件
   - UDP视频流传输：通过UDP协议传输视频帧

## 下一步计划

1. 完善视频监控页面，实现多摄像头画面同时显示
2. 优化前端数据刷新机制，减少不必要的API请求
3. 添加老人活动统计图表，支持时间段筛选
4. 实现报警事件历史查询功能
5. 开发移动端响应式界面，支持手机访问
6. 集成WebSocket，实现实时告警推送
7. 完善K230开发板跌倒检测算法，提高准确率
8. 增加系统日志记录和审计功能

## 项目成员

- 开发人员：昆明理工大学物联网工程专业学生
- 指导老师：xxx

---

最后更新：2024-05-30
