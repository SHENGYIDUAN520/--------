# 智能陪护监控平台

## 项目概述
智能陪护监控平台是一套基于深度学习和计算机视觉技术的养老监护系统，通过摄像头实时分析老人的行为和状态，自动检测异常情况并发出警报。系统包括前端监控界面、后端服务器和数据分析模块，为养老机构提供全面的智能监控解决方案。

## 硬件配置
- **开发板**：立创·庐山派-K230-CanMV开发板
  - 处理器：嘉楠K230 AI芯片
  - 内存：512MB
  - 接口：40针树莓派兼容GPIO接口，支持I2C、SPI、UART等标准协议
  - AI能力：支持多种AI模型，如人脸检测、姿态识别、跌倒检测等
  - ADC接口：提供4路ADC输入（最高支持1.8V输入电压）
  - CSI接口：支持多达3路摄像头输入
- **摄像头**：立创·GC2093-200W摄像头-小镜头版-定焦70cm
  - 感光元件：GC2093
  - 最大分辨率：1920x1080
  - 最大帧率：60fps
  - 焦距：4.3MM
  - 视场角：D73°/H65°/V40°
  - 接口：22P 0.5mm间距CSI2接口
- **存储**：8G TF卡（Class10及以上，MK品牌推荐）
- **服务器**：阿里云ECS（4核8G内存）
公网ip   47.97.160.91

## 技术栈
- 前端：HTML5, CSS3, JavaScript, ECharts
- 后端：Python, Flask
- 数据库：MySQL
- 图像处理：OpenCV, Paddle
- 部署：Alibaba Cloud ECS (47.97.160.91)

## 开发环境
### 本地开发环境
- **操作系统**: Windows 10/11
- **数据库**: MySQL 8.0 (本地实例)
- **前端服务**: 直接通过浏览器加载HTML文件
- **后端服务**: Python Flask (开发模式)
- **集成开发环境**: Visual Studio Code
- **K230开发环境**: CanMV IDE K230 (最新版本4.0.7+)

### 生产环境
- **服务器**: 阿里云ECS Ubuntu 20.04 LTS
- **Web服务器**: Nginx 1.18+ (作为反向代理)
- **应用服务器**: Gunicorn + Flask
- **数据库**: MySQL 8.0
- **监控**: 阿里云监控服务

## 开发进度记录

### 2024-05-27 系统设置功能优化与数据库对接
- 完善系统设置模块中的账户设置功能，实现与API的对接
- 优化老人管理功能，实现老人信息的添加、编辑和删除
- 完善紧急联系人管理系统，实现与老人信息的关联
- 修改模态窗口表单内容，确保与后端API数据结构匹配
- 优化页面数据加载和表单提交流程
- 实现实时数据验证和用户友好的错误提示

### 2024-05-25 前后端集成与数据流优化
- 完成数据库API与前端页面的深度集成
- 优化视频流处理模块，实现实时视频传输和存储
- 改进前端用户认证流程，增强安全性
- 老人信息管理系统功能完善，支持批量导入与导出
- 统一数据获取接口，采用RESTful API标准
- 解决跨域问题，确保开发环境和生产环境一致性
- 规划K230开发板与服务器间的通信协议升级

### 2024-05-23 用户管理功能增强
- 实现用户注册功能，添加前端注册页面(register.html)和相关业务逻辑
- 完善用户信息验证机制，包括密码强度检查、邮箱格式验证等
- 优化登录/注册页面UI，添加表单验证和用户友好提示
- 增强前后端用户系统对接，改善用户体验

### 2024-05-15 数据库与API对接
- 创建并成功初始化MySQL数据库，建立基本表结构
- 移除Redis相关代码，统一使用MySQL作为唯一数据存储
- 实现数据库API模块(database/api.py)，提供各类数据操作接口
- 创建Flask应用程序(app.py)，实现RESTful API接口
- 前端页面重构，移除本地静态数据，改为动态加载结构
- 实现用户认证、会话管理等基础功能

### 2024-05-10 前端页面基础开发
- 开发首页仪表盘界面，包含多个数据展示面板
- 实现老人详情页面，用于展示老人基本信息和活动数据
- 开发视频监控页面，支持实时视频流显示和录制功能
- 实现系统设置页面，包含用户管理、设备配置等功能
- 添加页面导航和基础样式

### 2024-05-05 数据库设计与配置
- 设计数据库表结构，包括用户、老人信息、设备、报警事件等
- 配置MySQL数据库连接
- 初步规划Redis缓存(后决定不使用)
- 编写数据库初始化脚本

### 2024-04-30 项目初始化
- 确定项目架构和技术栈
- 设置开发环境
- 创建项目基础目录结构
- 编写项目需求文档

## 项目结构
```
智能陪护监控平台/
│
├── database/               # 数据库相关模块
│   ├── __init__.py         # 数据库模块入口
│   ├── mysql_db.py         # MySQL连接和操作
│   ├── api.py              # 数据库API接口
│   ├── config.py           # 数据库配置
│   └── init_db.py          # 数据库初始化脚本
│
├── static/                 # 前端静态资源
│   ├── css/                # 样式文件
│   ├── js/                 # JavaScript文件
│   │   ├── common.js       # 通用JavaScript函数
│   │   ├── login.js        # 登录页面脚本
│   │   └── register.js     # 注册页面脚本
│   ├── img/                # 图片资源
│   ├── index.html          # 首页
│   ├── detail.html         # 老人详情页
│   ├── video.html          # 视频监控页
│   ├── settings.html       # 系统设置页
│   ├── login.html          # 登录页面
│   └── register.html       # 注册页面
│
├── app.py                  # Flask应用程序入口
├── requirements.txt        # 项目依赖
└── README.md               # 项目说明文档
```

## 核心功能
- 实时视频监控：支持多路摄像头，提供流畅的视频流显示
- 跌倒检测与报警：利用YOLOv5n-falldown模型实时检测老人跌倒情况
- 人脸识别与老人识别：使用K230内置的人脸识别功能识别老人身份
- 姿态异常检测：基于YOLOv8n-pose模型分析老人姿态是否异常
- 历史录像存储与回放：支持录像的存储、检索和回放
- 设备管理：支持摄像头的添加、配置和状态监控
- 用户权限管理：分级权限控制，支持管理员、工作人员和家属角色
- 报警事件管理与处理：报警事件的记录、通知和处理流程

## 系统架构
1. **前端部分**
   - 用户管理界面：管理系统用户，分配权限
   - 视频监控界面：实时展示多路摄像头画面，显示警报信息
   - 老人详情界面：展示老人基本信息和历史记录
   - 历史记录查询界面：检索和播放历史视频记录
   - 报警通知与处理界面：显示报警事件，提供处理操作
   - 设置界面：系统参数配置，设备管理

2. **后端部分**
   - Flask Web服务器：提供API接口，处理前端请求
   - 视频流处理模块：接收并处理K230发送的视频流
   - 数据库存储与查询模块：管理MySQL数据操作
   - 用户认证与权限控制模块：JWT认证和权限验证
   - 报警事件处理模块：处理异常事件，发送通知
   - WebSocket实时通信：实现报警的实时推送

3. **数据库设计**
   - 用户管理表：存储用户信息和权限
   - 老人信息表：记录老人基本信息
   - 摄像头设备表：管理摄像头配置和状态
   - 视频记录表：存储录像文件信息
   - 报警事件表：记录异常事件详情和处理状态
   - 设备状态表：记录设备的在线状态和最后活动时间
   - 临时会话表：存储用户会话和临时数据

4. **边缘计算部分**
   - 庐山派K230开发板：搭载嘉楠K230 AI芯片
   - 摄像头视频采集：支持多路摄像头输入
   - 本地AI推理：在边缘设备上进行AI模型推理
     * 跌倒检测：使用YOLOv5n-falldown模型
     * 姿态识别：使用YOLOv8n-pose模型
     * 人脸识别：使用K230内置模型
   - 报警事件上传：通过HTTP接口上传异常事件
   - UDP视频流传输：通过UDP协议传输视频帧

## K230开发板使用指南
1. **环境准备**
   - 安装CanMV IDE K230最新版（当前4.0.7+）
   - 准备8G以上Class10 TF卡（推荐MK品牌）
   - 下载最新的庐山派K230固件
   - 使用Type-C数据线连接开发板和电脑

2. **摄像头配置**
   - 将GC2093摄像头连接到CSI2接口（22P立式接口）
   - 启动开发板，自动识别摄像头
   - 如果排线看起来歪斜是正常的，可塞在CSI2座子和亚克力面板之间
   - 如果IDE无图像显示，点击IDE右边小三角显示帧缓冲区

3. **开发案例**
   - 基于examples/05-AI-Demo中的示例进行开发
   - 使用object_detect_yolov8n.py和pose_detect_yolov8n.py作为参考
   - 使用licence_det_rec.py作为识别参考
   - 常用AI模型位于TF卡根目录的kmodel文件夹中

4. **代码部署**
   - 通过CanMV IDE将k230_video_client.py上传到开发板
   - 修改SERVER_URL为实际服务器地址（阿里云ECS: 47.97.160.91）
   - 通过IDE运行脚本，实现视频采集与跌倒检测
   - 使用examples/14-Socket中的示例实现网络通信

5. **开发板GPIO使用**
   - 40针树莓派兼容GPIO可连接各种传感器和外设
   - 使用I2C接口连接传感器，实现环境监测
   - 使用SPI接口扩展功能，如显示屏等
   - 注意ADC接口最高支持1.8V输入电压

## 本地开发与测试指南
1. **环境准备**
   - 安装MySQL
   - 安装Python 3.8+
   - 运行`install_requirements.py`安装依赖
   - 设置数据库连接参数

2. **数据库配置**
   - 修改`database/config.py`中的数据库连接参数
   - 运行数据库初始化脚本创建表结构

3. **启动服务**
   - 运行`python server.py`启动Flask服务器
   - 直接在浏览器中打开HTML文件访问前端页面
   - 测试API接口和WebSocket连接

4. **K230开发板测试**
   - 按照开发板文档配置摄像头
   - 修改开发板代码中的服务器地址为本地IP或阿里云服务器IP
   - 通过CanMV IDE上传并运行摄像头代码
   - 确认视频流和报警信息正常传输

## 项目文件结构
```
智能陪护监控平台/
├── css/                  # 样式文件
├── js/                   # JavaScript文件
├── static/               # 静态资源
│   ├── images/           # 图片资源
│   └── recordings/       # 视频录制文件
├── database/             # 数据库相关文件
│   ├── config.py         # 数据库配置
│   ├── init_db.py        # 数据库初始化脚本
│   └── mysql_db.py       # MySQL操作模块
├── server.py             # 主服务器文件
├── api_services.py       # API服务模块
├── api_models.py         # API模型定义
├── k230_video_client.py  # K230视频客户端
├── install_requirements.py # 依赖安装脚本
├── *.html                # 前端页面文件
└── README.md             # 项目说明文档
```

## 下一步计划
1. 增强AI模型精度，减少误报和漏报
2. 实现K230开发板的多模型融合检测
3. 添加移动端适配，支持手机访问
4. 增加更多传感器集成，如温湿度、环境光等
5. 实现视频回放的AI分析功能
6. 优化报警通知机制，支持短信和邮件通知
7. 添加系统性能监控和日志分析功能

## 项目成员
- 开发人员：昆明理工大学物联网工程专业学生
- 指导老师：xxx

---

最后更新：2024-05-23
